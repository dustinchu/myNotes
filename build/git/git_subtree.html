<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>git_subtree - 2</title><meta name="description" content="手把手帶大家動手做 Youtube Tutorial PART 1 - git subtree tutorial - how to create subtree"><meta name="keywords" content="git_subtree - 2"><script src="/static/js/jquery-3.3.1.min.js"></script><script src="/static/js/vue.min.js"></script><link rel="stylesheet" href="/static/css/normalize.min.css"><link rel="stylesheet" href="/static/css/monaco.css"><link rel="stylesheet" href="/static/css/loading.css"><link rel="stylesheet" href="/static/css/editormd.min.css"><link rel="stylesheet" href="/static/css/style.css"><link rel="stylesheet" href="/static/css/mobile.css"><link rel="stylesheet" href="/static/font-awesome-4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/static/css/highlight.default.min.css"><script src="/static/js/highlight.min.js"></script><script>window._CONST={ROOT_PATH:"/"},hljs.initHighlightingOnLoad()</script></head><body><div class="main"><div class="tea-menu"><div class="tea-menu-title"><i class="fa fa-home" aria-hidden="true"></i> <span>2</span></div><div class="tea-menu-search-warp"><i class="fa fa-search"></i> <input type="text" placeholder="搜索文档" value="" height="100%"></div><ul class="tea-menu-list"><li><a href="/index.html" title="介绍" class="">介绍</a></li><li><a href="/quick_start.html" title="快速入门" class="">快速入门</a></li><li><a href="/install.html" title="安装" class="">安装</a></li><li><a title="Dart" class="">Dart<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/dart/flutter.html" title="Flutter相關資源" class="">Flutter相關資源</a></li><li><a href="/dart/Learn.html" title="Flutter學習程式範例" class="">Flutter學習程式範例</a></li><li><a href="/dart/UI.html" title="FlutterUI相關" class="">FlutterUI相關</a></li><li><a href="/dart/flutterGithub.html" title="FlutterGithub相關" class="">FlutterGithub相關</a></li><li><a href="/dart/flutterLibrary.html" title="Flutter常用庫" class="">Flutter常用庫</a></li><li><a href="/dart/flutterOpenSource.html" title="Flutter範例+源代碼+youtube連結" class="">Flutter範例+源代碼+youtube連結</a></li><li><a href="/dart/FlutterJson.html" title="Flutter Json" class="">Flutter Json</a></li></ul></li><li><a title="Python" class="">Python<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a title="AI相關" class="">AI相關<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/python/ai.html" title="AI相關" class="">AI相關</a></li><li><a href="/python/ai/fastText.html" title="FACEBOOK 出的 自然語言學習 fastText" class="">FACEBOOK 出的 自然語言學習 fastText</a></li></ul></li><li><a href="/python/flask.html" title="Flask" class="">Flask</a></li><li><a title="日文相關" class="">日文相關<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/python/jp/jp.html" title="日文相關用法" class="">日文相關用法</a></li><li><a href="/python/jp/githubJp.html" title="語言數據的Python庫（中文，日文和韓文）" class="">語言數據的Python庫（中文，日文和韓文）</a></li><li><a href="/python/jp/githubJp1.html" title="日语词典终端版" class="">日语词典终端版</a></li><li><a href="/python/jp/githubJp2.html" title="基於遞歸神經網絡的日語標記器" class="">基於遞歸神經網絡的日語標記器</a></li><li><a href="/python/jp/githubJp3.html" title="日本負面積極分類。日本語文書のネガポジを判定。" class="">日本負面積極分類。日本語文書のネガポジを判定。</a></li><li><a href="/python/jp/githubjp4.html" title="用純Python編寫的日本形態分析引擎 " class="">用純Python編寫的日本形態分析引擎</a></li><li><a href="/python/jp/other.html" title="其他" class="">其他</a></li></ul></li><li><a href="/python/Library.html" title="一些好用庫" class="">一些好用庫</a></li><li><a title="爬蟲" class="">爬蟲<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/python/spider/other.html" title="爬蟲相關" class="">爬蟲相關</a></li></ul></li></ul></li><li><a title="其他" class="">其他<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/other/Record.html" title="其他紀錄" class="">其他紀錄</a></li><li><a href="/other/AnkiWen.html" title="AnkiWen" class="">AnkiWen</a></li><li><a href="/other/book.html" title="電子書相關" class="">電子書相關</a></li><li><a href="/other/data.html" title="機器學習深度學習資料" class="">機器學習深度學習資料</a></li><li><a href="/other/aidata.html" title="學習語料與資料" class="">學習語料與資料</a></li><li><a href="/other/ai.html" title="AI相關" class="">AI相關</a></li></ul></li><li><a title="Git" class="active">Git<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/git/Multiple_SSH_Keys.html" title="Multiple SSH Keys" class="">Multiple SSH Keys</a></li><li><a href="/git/git_Submodule.html" title="git Submodule" class="">git Submodule</a></li><li><a href="/git/git_subtree.html" title="git_subtree" class="active">git_subtree</a></li><li><a href="/git/git_tutoria.html" title="git_tutorials基本使用">git_tutorials基本使用</a></li><li><a href="/git/README.html" title="readme">readme</a></li></ul></li><li><a title="java">java<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/java/other.html" title="其他">其他</a></li><li><a title="DL4J">DL4J<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/java/dl4j/other.html" title="其他">其他</a></li><li><a href="/java/dl4j/wordVecGithub.html" title="WordVecGithub">WordVecGithub</a></li></ul></li><li><a title="電子書">電子書<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/java/book/javabook.html" title="Java工程师修炼之道 - 梳理Java知识体系">Java工程师修炼之道 - 梳理Java知识体系</a></li><li><a href="/java/book/bookvideo.html" title="開源項目詳細資料與影片">開源項目詳細資料與影片</a></li></ul></li><li><a title="Vaadin">Vaadin<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/java/vaadin/other.html" title="其他">其他</a></li><li><a href="/java/vaadin/css.html" title="CSS">CSS</a></li></ul></li><li><a title="Android">Android<i class="fa fa-angle-down unfold"></i></a><ul class="unfold"><li><a href="/java/android/other.html" title="其他">其他</a></li><li><a href="/java/android/tips.html" title="填坑手冊">填坑手冊</a></li></ul></li></ul></li><li><a href="/template_markdown.html" title="markdown模版">markdown模版</a></li><li><a href="/custom_theme.html" title="自定义主题">自定义主题</a></li><li><a href="/deploy.html" title="部署">部署</a></li></ul><div class="tea-version"><p>version: 0.0.1</p><p>Built with <a href="https://github.com/lisniuse/teadocs" target="_blank">Teadocs</a></p></div></div><div class="tea-content"><div class="tea-nav"><h3 class="top-title" style="font-weight:500;margin:0;font-size:16px"><i class="fa fa-navicon" aria-hidden="true"></i> <span>git_subtree</span></h3></div><div class="tea-container"><article class="markdown-body"><h1 id="git-subtree-tutorial-:memo:"><a href="#git-subtree-tutorial-:memo:" class="header-anchor">#</a> <span>git subtree tutorial :memo:</span></h1><p>手把手帶大家動手做 <a href="https://youtu.be/kEvgK2gH_vg">Youtube Tutorial PART 1 - git subtree tutorial - how to create subtree</a></p><p>還記得之前和大家介紹過 <a href="https://github.com/twtrubiks/Git-Tutorials/blob/master/git_submodule_turorial.md">git Submodule tutorial 📝</a> 這個指令嗎:question:</p><p>忘記得趕快去複習一下吧:smirk:</p><p>今天我要再來介紹一個類似功能的指令，名稱叫做 <strong>git-subtree</strong>，如果你用 git-subtree 和 git submodule</p><p>去 google，你會發現蠻多人拿這兩個來比較的，然後都說什麼 git-subtree 比較推薦之類的，但我這邊先</p><p>不下結論，結論在最後面，我先帶大家來了解他怎麼使用。</p><h2 id="簡介"><a href="#簡介" class="header-anchor">#</a> <span>簡介</span></h2><p>我先用兩句話來描述 git submodule 和 git subtree 的差異，</p><p><strong><em>git submodule 是 link 的概念，而 git subtree 則是 copy的概念</em></strong></p><p>( 如果你看不懂，建議先去閱讀之前我介紹的 Submodule 的 <a href="https://github.com/twtrubiks/Git-Tutorials/blob/master/git_submodule_turorial.md">文章</a> 吧 )</p><p>git subtree 的指令沒有很多，主要指令如下，</p><pre class="prettyprint language-text"><code>'git subtree' add   -P &lt;prefix&gt; &lt;commit&gt;
'git subtree' pull  -P &lt;prefix&gt; &lt;repository&gt; &lt;refspec...&gt;
'git subtree' push  -P &lt;prefix&gt; &lt;repository&gt; &lt;refspec...&gt;
'git subtree' merge -P &lt;prefix&gt; &lt;commit&gt;
'git subtree' split -P &lt;prefix&gt; [OPTIONS] [&lt;commit&gt;]</code></pre><p>更多詳細內容可參考 <a href="https://github.com/apenwarr/git-subtree/blob/master/git-subtree.txt">git-subtree</a> 文件。</p><h2 id="教學"><a href="#教學" class="header-anchor">#</a> <span>教學</span></h2><h3 id="how-to-create-git-subtree"><a href="#how-to-create-git-subtree" class="header-anchor">#</a> <span>how to create git subtree</span></h3><p>先介紹一下 repo ，這邊有兩個 repo，分別為 main_project_subtree<br>repo 以及 a_project_subtree repo，</p><p>先把 main_project_subtree repo clone 下來，</p><pre class="prettyprint language-cmd"><code>git clone git@github.com:blue-rubiks/main_project_subtree.git</code></pre><p>main_project_subtree repo log 如下，</p><p><img src="https://i.imgur.com/I6i93rr.png" alt="alt tag"></p><p>接下來，要加入 subtree ( 也就是 a_project_subtree )，使用以下指令</p><pre class="prettyprint language-cmd"><code>git subtree add --prefix=a_project_subtree --squash git@github.com:blue-rubiks/a_project_subtree.git master</code></pre><p>or</p><pre class="prettyprint language-cmd"><code>git subtree add -P a_project_subtree --squash git@github.com:blue-rubiks/a_project_subtree.git master</code></pre><p><code>--prefix</code> option <a href="https://github.com/apenwarr/git-subtree/blob/master/git-subtree.txt">文件</a> 說明如下，</p><pre class="prettyprint language-text"><code>-P &lt;prefix&gt;::
--prefix=&lt;prefix&gt;::
    Specify the path in the repository to the subtree you
    want to manipulate.  This option is mandatory
    for all commands.</code></pre><p>簡單說，prefix 就是指定一個目錄。</p><p><code>--squash</code> option <a href="https://github.com/apenwarr/git-subtree/blob/master/git-subtree.txt">文件</a> 說明如下，</p><pre class="prettyprint language-text"><code>With '--squash', imports only a single commit from the subproject, rather than its entire history.</code></pre><p>也就是說，如果沒有使用 <code>--squash</code>，會將 a_project_subtree 的 log ( 歷史訊息 ) 全部顯示出來</p><p>( 請有 log 會變很長又有點亂的心理準備 :scream: )，</p><p>但通常我們不太需要顯示全部的 log ( 尤其是依賴的 repo )，所以記得加上 <code>--squash</code> option，</p><p>這樣的話，就會將全部的 log 合成一個 log</p><p>( 其實是兩個，因為還會有一個 merge 的 log :smiley: )</p><p><img src="https://i.imgur.com/aUSe38E.png" alt="alt tag"></p><p>main_project_subtree repo log 會變成如下，會多兩個 log，</p><p><img src="https://i.imgur.com/NS0aB4B.png" alt="alt tag"></p><p>如果你覺得以上指令實在太長了，可以拆成兩步驟，先執行，</p><pre class="prettyprint language-cmd"><code>git remote add a_project_subtree git@github.com:blue-rubiks/a_project_subtree.git</code></pre><p>更多詳細資料可參考 <a href="https://git-scm.com/docs/git-remote">git-remote</a>。</p><p>然後執行</p><pre class="prettyprint language-cmd"><code>git subtree add -P a_project_subtree --squash a_project_subtree master</code></pre><p>其實就是將 remote url 變成 a_project_subtree 而已:thumbsup:</p><h3 id="how-to-push-git-subtree"><a href="#how-to-push-git-subtree" class="header-anchor">#</a> <span>how to push git subtree</span></h3><p><a href="https://youtu.be/Df3zc1VOqN8">Youtube Tutorial PART 2 - git subtree tutorial - how to push subtree</a></p><p>現在的 main_project_subtree 基本上已經將 a_project_subtree 整個 copy 過來了，就算現在</p><p>a_project_subtree remote repo 被刪除也沒關係 ( 因為是 copy 過來的 )，而且 developer 甚至</p><p>不需要知道有 a_project_subtree 的存在，直接使用一般的 git 操作即可，也就是說，現在</p><p>a_project_subtree 就像是在 main_project_subtree 裡面的一個目錄一樣。</p><p>如果你修改了 a_project_subtree ，並且執行 git push，在 main_project_subtree 中可以看到</p><p>資料被修改，但是在 a_project_subtree 中會看不到修改，因為還沒有 push 到 a_project_subtree，</p><p>那該如何 push 到 a_project_subtree 上呢:question:</p><p>可以使用以下指令</p><pre class="prettyprint language-cmd"><code>git subtree push -P a_project_subtree a_project_subtree master</code></pre><p>或是</p><pre class="prettyprint language-cmd"><code>git subtree push -P a_project_subtree git@github.com:blue-rubiks/a_project_subtree.git master</code></pre><p>update a_project_subtree，</p><p><img src="https://i.imgur.com/QsyZEcK.png" alt="alt tag"></p><p>接著 push 改變到 a_project_subtree repo，</p><p><img src="https://i.imgur.com/F8SJ2pn.png" alt="alt tag"></p><p>注意 <code>4/4 (2)</code> 這個，他每次都會重新 ( 重源頭 ) 計算，所以如果你一直增加 a_project_subtree 的 commit，</p><p>每次 push 到 a_project_subtree 的速度會越來越慢，該如何解決:question:</p><p>後面會介紹 :smirk:</p><p><img src="https://i.imgur.com/PnpAmqU.png" alt="alt tag"></p><p>如果你要 push 改變到 main_project_subtree，直接執行一般的 <code>git push</code> 操作就行了，</p><p><img src="https://i.imgur.com/2T9Bn13.png" alt="alt tag"></p><p>到這邊我們休息一下:relaxed:</p><p>在簡介的時候我們說過 <strong>git submodule 是 link 的概念，而 git subtree 則是 copy 的概念</strong>，所以如果你</p><p>仔細看 main_project_subtree 以及 a_project_subtree 的 log，你會發現他們是不一樣的 ( 因為 git subtree</p><p>有自己的策略 )，而之前介紹的 git submodule 則會有相同的 commit id 以及 submodule 的 commit link。</p><h3 id="how-to-pull-git-subtree"><a href="#how-to-pull-git-subtree" class="header-anchor">#</a> <span>how to pull git subtree</span></h3><p><a href="https://youtu.be/dE-D2yrD4ws">Youtube Tutorial PART 3 - git subtree tutorial - how to pull/create subtree</a></p><p>如果今天我們要更新 a_project_subtree repo 可以使用以下指令，</p><pre class="prettyprint language-cmd"><code>git subtree pull -P a_project_subtree a_project_subtree master</code></pre><p>或是</p><pre class="prettyprint language-cmd"><code>git subtree pull -P a_project_subtree git@github.com:blue-rubiks/a_project_subtree.git master</code></pre><p>執行後，應該會跳出 <code>fatal: refusing to merge unrelated histories</code> 失敗的訊息，</p><p><img src="https://i.imgur.com/hcqBtrK.png" alt="alt tag"></p><p>會出現這個的原因是因為我們在前面有執行 <code>git subtree add -P a_project_subtree --squash</code></p><p>中的 <code>--squash</code>，所以 pull 的時候也必須加上，也就是如下，</p><p><img src="https://i.imgur.com/AoOcXFa.png" alt="alt tag"></p><p>這樣才可以成功 pull :smile:</p><h3 id="git-subtree-split"><a href="#git-subtree-split" class="header-anchor">#</a> <span>git subtree split</span></h3><p>split 這個指令比較特別，在這邊我提一下，在前面的 <a href="https://github.com/twtrubiks/Git-Tutorials/blob/master/git_subtree_turorial.md#how-to-push-git-subtree">how to push git subtree</a> 部分有提到 <code>4/4 (2)</code></p><p>這個是他每次都會重新計算，所以如果你一直增加 commit，push 速度會越來越慢的這個問題，</p><p>而 split 可以解決這個問題，他會從一個最新的點開始計算，不用每次都重頭計算:smile:</p><p>先來看一下 <a href="https://github.com/apenwarr/git-subtree/blob/master/git-subtree.txt">文件</a>，<code>--rejoin</code> option</p><pre class="prettyprint language-text"><code>If you do all your merges with '--squash', don't use
'--rejoin' when you split, because you don't want the
subproject's history to be part of your project anyway.</code></pre><p>我們在 <code>git subtree add</code> 以及 <code>git subtree pull</code> 都有使用 <code>--squash</code>，所以</p><p>如果再使用<code>--rejoin</code> option 的話，會導致 a_project_subtree 的 history log 都</p><p>被 clone 回來，所以我們必須再加上 <code>--ignore-joins option</code>，指令如下，</p><pre class="prettyprint language-cmd"><code>git subtree split --rejoin --prefix=a_project_subtree --ignore-joins</code></pre><p><img src="https://i.imgur.com/owS1Nz7.png" alt="alt tag"></p><p>這樣就完成 split 了，當我們如果有改動 a_project_subtree，<code>4/4 (2)</code> 這個就會重最新的點開始計算，</p><p>不會每次都重頭計算，導致 push 速度越來越慢:satisfied:</p><h2 id="結論"><a href="#結論" class="header-anchor">#</a> <span>結論</span></h2><p>介紹完了 subtree ，一定要來說說我對 subtree 以及 submodule 的看法:laughing:</p><p>在 submodule 中執行 init 以及如果要移除掉 submodule 時，步驟都比較繁瑣，</p><p>相對 subtree 來說，subtree 簡單很多，因為對 developer 來說，他就像一個</p><p>目錄一樣，就算今天 subtree 的 remote repo 被刪除也不擔心:smiley:</p><p>但是我相信大家一定也發現了，使用 subtree 的時候，我們如果要切換 branch</p><p>並沒有想像中的容易 ( 在 submodule 中，我們可以進到依賴的 repo 中，然後</p><p>像操作一般的 git 使用 <code>git checkout</code> 來切換 branch，但在 subtree 中卻無法</p><p>這樣使用，因為他是整個 copy 過來的，不像 submodule 那樣是 link 的概念。 )</p><p>所以如果有切分支 ( 你依賴的 repo )，建議還是使用 submodule 會比較方便，</p><p>另外一個點是，我覺得使用 subtree 時，會讓 log 變得有點亂:weary:，不像</p><p>submodule 那樣清楚很多:smile:</p><p>而且 subtree 的侵略性比較強 ( commit id 都會改變)，大家在使用時，要多了解</p><p>一下，雖然 subtree 指令看似只有幾個，但是整體使用下來，還是很多細節要注意:sweat_smile:</p><h2 id="Donation"><a href="#Donation" class="header-anchor">#</a> <span>Donation</span></h2><p>文章都是我自己研究內化後原創，如果有幫助到您，也想鼓勵我的話，歡迎請我喝一杯咖啡:laughing:</p><p><img src="https://i.imgur.com/LRct9xa.png" alt="alt tag"></p><p><a href="https://payment.opay.tw/Broadcaster/Donate/9E47FDEF85ABE383A0F5FC6A218606F8">贊助者付款</a></p><h2 id="License"><a href="#License" class="header-anchor">#</a> <span>License</span></h2><p>MIT license</p></article></div></div><i class="fa fa-arrow-circle-up gotop" aria-hidden="true"></i><div id="menu-mask"></div></div><script src="/static/js/main.js"></script><script src="/static/js/mobile.js"></script></body></html>